(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[724],{71594:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return r(96597)}])},96597:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>w});var a=r(37876),s=r(14232),n=r(75656),l=r(80252),i=r(26320),o=r(84758),c=r(22333),d=r(24354),u=r(32895),m=r(46306),h=r(28834),x=r(11713);let p=(0,x.A)("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),g=(0,x.A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),y=(0,x.A)("shopping-cart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),j=(0,x.A)("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),f=e=>fetch(e,{cache:"no-store"}).then(e=>e.json());function k(e){let t={};return e.forEach(e=>{var r;let a=new Date(e.date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"});t[a]=(t[a]||0)+Number(null!=(r=e.valeur)?r:0)}),t}function N(e){let{icon:t,title:r,value:s}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow p-4 flex items-center gap-4",children:[(0,a.jsx)("div",{className:"p-3 rounded-full bg-teal-50 text-teal-700",children:t}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:r}),(0,a.jsx)("p",{className:"text-xl font-semibold",children:s})]})]})}function w(){let[e,t]=(0,s.useState)(!1);(0,s.useEffect)(()=>t(!0),[]);let{data:r=[],error:x}=(0,n.Ay)("/api/stock",f),{data:w=[],error:v}=(0,n.Ay)("/api/commandes",f),{data:b=[],error:A}=(0,n.Ay)("/api/mouvements?type=entree",f),{data:E=[],error:M}=(0,n.Ay)("/api/mouvements?type=sortie",f);if(x)return(0,a.jsx)("p",{children:"Erreur de chargement du stock."});if(v)return(0,a.jsx)("p",{children:"Erreur de chargement des commandes."});if(A)return(0,a.jsx)("p",{children:"Erreur de chargement des entr\xe9es."});if(M)return(0,a.jsx)("p",{children:"Erreur de chargement des sorties."});let _=(0,s.useMemo)(()=>Array.isArray(r)?r.map(e=>{var t,r,a;return{...e,qteStock:Number(null!=(t=e["Qte stock"])?t:0),qteMini:Number(null!=(r=e["Qte mini"])?r:0),enCommande:Number(null!=(a=e["En Commande"])?a:0)}}):[],[r]),S=(0,s.useMemo)(()=>_.map(e=>{let t=e.qteMini-(e.qteStock+e.enCommande);return t>0?{...e,toOrder:t}:null}).filter(Boolean),[_]),D=(0,s.useMemo)(()=>{let e=_.length,t=S.length;return{totalItems:e,lowStock:t,pendingPOs:w.filter(e=>"en cours"===e.statut).length,stockValue:_.reduce((e,t)=>{var r;return e+Number(null!=(r=t["PU HT"])?r:0)*t.qteStock},0)}},[_,S,w]),q=(0,s.useMemo)(()=>k(b),[b]),C=(0,s.useMemo)(()=>k(E),[E]),O=(0,s.useMemo)(()=>(function(e){let t=new Date,r=[];for(let e=6;e>=0;e--){let a=new Date(t);a.setDate(t.getDate()-e),r.push(a.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"}))}return r})(0),[]),P=(0,s.useMemo)(()=>O.map(e=>({jour:e,entrees:q[e]||0,sorties:C[e]||0})),[O,q,C]);return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col p-6",children:[(0,a.jsxs)("section",{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-4 mb-6",children:[(0,a.jsx)(N,{icon:(0,a.jsx)(p,{className:"h-6 w-6"}),title:"Articles totaux",value:D.totalItems}),(0,a.jsx)(N,{icon:(0,a.jsx)(g,{className:"h-6 w-6"}),title:"Sous le minimum",value:D.lowStock}),(0,a.jsx)(N,{icon:(0,a.jsx)(y,{className:"h-6 w-6"}),title:"BC en attente",value:D.pendingPOs}),(0,a.jsx)(N,{icon:(0,a.jsx)(j,{className:"h-6 w-6"}),title:"Valorisation",value:D.stockValue.toLocaleString("fr-FR",{style:"currency",currency:"EUR",maximumFractionDigits:0})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow p-4",children:[(0,a.jsxs)("h2",{className:"text-lg font-medium mb-4",children:["Entr\xe9es/Sorties (dernier ",7," jours)"]}),(0,a.jsx)("div",{className:"h-80",children:e?(0,a.jsx)(l.u,{width:"100%",height:"100%",children:(0,a.jsxs)(i.b,{data:P,margin:{top:10,right:30,left:0,bottom:5},children:[(0,a.jsx)(o.d,{strokeDasharray:"3 3"}),(0,a.jsx)(c.W,{dataKey:"jour"}),(0,a.jsx)(d.h,{allowDecimals:!1,domain:[0,"auto"]}),(0,a.jsx)(u.m,{}),(0,a.jsx)(m.s,{verticalAlign:"top",height:36}),(0,a.jsx)(h.N,{type:"monotone",dataKey:"entrees",name:"Entr\xe9es",stroke:"#00a6b2",dot:{r:4}}),(0,a.jsx)(h.N,{type:"monotone",dataKey:"sorties",name:"Sorties",stroke:"#ff5c5c",dot:{r:4}})]})}):(0,a.jsx)("p",{className:"text-center text-gray-500",children:"Chargementâ€¦"})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[398,636,593,792],()=>t(71594)),_N_E=e.O()}]);